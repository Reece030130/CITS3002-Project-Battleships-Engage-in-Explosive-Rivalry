name: Auto Branch for Issue

on:
  # The issue.opened event below is only needed for the "immediate" mode.
  # The issue.assigned event below is only needed for the default ("auto") mode.
  issues:
    types: [ opened, assigned ]
  # The issue_comment.created event below is only needed for the ChatOps mode.
  issue_comment:
    types: [ created ]
  # The pull_request events below are only needed for pull-request related features.
  pull_request:
    types: [ opened, closed ]

jobs:
  create_issue_branch_job:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Git Branch Creation
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          ISSUE_NUMBER=${{ github.event.issue.number }}
          ISSUE_TITLE="${{ github.event.issue.title }}"
  
          # Clean and format the issue title for branch naming
          ISSUE_BRANCH="issue-${ISSUE_NUMBER}-${ISSUE_TITLE// /-}"
          ISSUE_BRANCH=$(echo "$ISSUE_BRANCH" | tr '[:upper:]' '[:lower:]' | tr -cd '[:alnum:]-' | cut -c1-63)
  
          echo "Creating branch: $ISSUE_BRANCH"
          
          # Fetch all branches and switch to the default branch (assumed as 'main')
          git fetch origin
          git checkout main
          
          # Debugging logs to show current status
          git status
          git branch -a
          
          # Create the new branch and push
          git checkout -b "$ISSUE_BRANCH"
          git push -u origin "$ISSUE_BRANCH"
  
          echo "Branch $ISSUE_BRANCH created and pushed"
